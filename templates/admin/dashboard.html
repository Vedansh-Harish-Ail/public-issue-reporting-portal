<!-- templates/admin/dashboard.html -->
{% extends "base.html" %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}

<div class="admin-dashboard-container"
  style="display: grid; grid-template-columns: 250px 1fr; gap: 30px; padding: 40px; min-height: 80vh; max-width: 1400px; margin: auto;">

  <!-- Sidebar -->
  <aside class="admin-sidebar"
    style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); height: fit-content;">
    <div style="text-align: center; margin-bottom: 30px;">
      <h3 style="color: var(--primary-color); margin: 0; font-family: var(--font-serif);">Admin Panel</h3>
      <small style="color: #777;">Panchayat Official</small>
    </div>

    <nav class="admin-nav">
      <ul style="list-style: none; padding: 0;">
        <li style="margin-bottom: 10px;">
          <a href="{{ url_for('admin_dashboard') }}"
            style="display: block; padding: 12px; background: #eef2f7; color: var(--primary-color); border-radius: 8px; font-weight: 600; text-decoration: none;">
            üìä Dashboard
          </a>
        </li>
        <li style="margin-bottom: 10px;">
          <a href="{{ url_for('admin_notices') }}"
            style="display: block; padding: 12px; color: #555; text-decoration: none; transition: 0.2s;"
            onmouseover="this.style.color='var(--primary-color)'" onmouseout="this.style.color='#555'">
            üì¢ Manage Notices
          </a>
        </li>
        <li style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
          <a href="{{ url_for('admin_logout') }}"
            style="display: block; padding: 12px; color: #c53030; text-decoration: none; font-weight: 500;">
            üö™ Logout
          </a>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="dashboard-main">

    <h2 style="margin: 0; color: #333;">Dashboard Overview</h2>
    <span style="font-size: 14px; color: #666;" id="currentDate"></span>
    <script>
      document.getElementById('currentDate').innerText = 'Date: ' + new Date().toLocaleDateString();
    </script>

    <!-- Stats Row -->
    <div class="dashboard-stats"
      style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
      <!-- Total -->
      <div class="stat-card"
        style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-left: 5px solid var(--primary-color);">
        <h3 style="margin: 0; font-size: 32px; color: var(--primary-color);">{{ issues|length }}</h3>
        <p style="margin: 5px 0 0; color: #777; font-size: 14px;">Total Issues</p>
      </div>

      <!-- Pending -->
      <div class="stat-card"
        style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-left: 5px solid var(--secondary-color);">
        {% set pending = issues|selectattr('status', 'equalto', 'Pending')|list|length %}
        <h3 style="margin: 0; font-size: 32px; color: var(--secondary-color);">{{ pending }}</h3>
        <p style="margin: 5px 0 0; color: #777; font-size: 14px;">Pending Actions</p>
      </div>

      <!-- Resolved -->
      <div class="stat-card"
        style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-left: 5px solid var(--accent-color);">
        {% set resolved = issues|selectattr('status', 'equalto', 'Completed')|list|length %}
        <h3 style="margin: 0; font-size: 32px; color: var(--accent-color);">{{ resolved }}</h3>
        <p style="margin: 5px 0 0; color: #777; font-size: 14px;">Resolved</p>
      </div>
    </div>

    <!-- Recent Issues Table -->
    <div class="recent-issues"
      style="background: white; padding: 30px; border-radius: 16px; box-shadow: 0 5px 20px rgba(0,0,0,0.05);">
      <h4 style="margin-top: 0; margin-bottom: 25px; color: #333;">Recent Complaints</h4>

      <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="text-align: left; background: #f9fafb; color: #666; font-size: 13px; text-transform: uppercase;">
              <th style="padding: 15px; border-radius: 8px 0 0 8px;">ID</th>
              <th style="padding: 15px;">Photo</th>
              <th style="padding: 15px;">Category</th>
              <th style="padding: 15px;">Reporter</th>
              <th style="padding: 15px;">Location</th>
              <th style="padding: 15px;">Status</th>
              <th style="padding: 15px;">Date</th>
              <th style="padding: 15px; border-radius: 0 8px 8px 0;">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for i in issues %}
            <tr style="border-bottom: 1px solid #eee; transition: background 0.2s;">
              <td style="padding: 15px; color: #888;">#{{ i.id }}</td>
              <td style="padding: 15px;">
                {% if i.photo_path %}
                <div style="position: relative; display: inline-block;">
                  <img src="{{ url_for('static', filename=i.photo_path) }}"
                    style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px; border: 1px solid #eee; cursor: pointer;"
                    onclick="openImageModal('{{ url_for('static', filename=i.photo_path) }}')"
                    title="Click to view full size">
                  <div
                    style="position: absolute; bottom: 3px; right: 3px; background: rgba(31, 63, 109, 0.75); color: white; padding: 2px 5px; border-radius: 8px; font-size: 9px; font-weight: 600; box-shadow: 0 1px 4px rgba(0,0,0,0.2);">
                    üîç
                  </div>
                </div>
                {% else %}
                <div
                  style="width: 50px; height: 50px; background: #f0f0f0; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                  üñºÔ∏è</div>
                {% endif %}
              </td>
              <td style="padding: 15px; font-weight: 600; color: var(--primary-color);">{{ i.category }}</td>
              <td style="padding: 15px; font-size: 14px;">
                <span style="font-weight: 500;">{{ i.reporter_name or 'Unknown' }}</span>
              </td>
              <td style="padding: 15px;">{{ i.location }}</td>
              <td style="padding: 15px;">
                <span style="font-size: 12px; padding: 4px 12px; border-radius: 20px; font-weight: 500;
                    {% if i.status == 'Completed' %} background: #def7ec; color: #047857;
                    {% elif i.status == 'In Progress' %} background: #e1effe; color: #1e429f;
                    {% else %} background: #fff8dd; color: #92400e; {% endif %}">
                  {{ i.status }}
                </span>
              </td>
              <td style="padding: 15px; font-size: 14px; color: #666;">{{ i.created_at[:10] }}</td>
              <td style="padding: 15px;">
                <a href="{{ url_for('admin_issue_detail', issue_id=i.id) }}"
                  style="text-decoration: none; color: var(--secondary-color); font-weight: 600; font-size: 14px;">View
                  &rarr;</a>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="6" style="padding: 30px; text-align: center; color: #777;">No issues found.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </div>

  </main>

</div>

{% endblock %}