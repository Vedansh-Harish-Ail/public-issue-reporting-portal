{% extends "base.html" %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}

<div class="admin-dashboard-container"
  style="display: grid; grid-template-columns: 250px 1fr; gap: 30px; padding: 40px; min-height: 80vh; max-width: 1400px; margin: auto;">

  <!-- Sidebar (Consistent) -->
  <aside class="admin-sidebar"
    style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); height: fit-content;">
    <div style="text-align: center; margin-bottom: 30px;">
      <h3 style="color: var(--primary-color); margin: 0; font-family: var(--font-serif);">Admin Panel</h3>
      <small style="color: #777;">Issue Management</small>
    </div>

    <nav class="admin-nav">
      <ul style="list-style: none; padding: 0;">
        <li style="margin-bottom: 10px;">
          <a href="{{ url_for('admin_dashboard') }}"
            style="display: block; padding: 12px; color: #555; text-decoration: none; font-weight: 500; transition: 0.2s;"
            onmouseover="this.style.color='var(--primary-color)'" onmouseout="this.style.color='#555'">
            &larr; Back to Dashboard
          </a>
        </li>
        <li style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
          <a href="{{ url_for('admin_logout') }}"
            style="display: block; padding: 12px; color: #c53030; text-decoration: none; font-weight: 500;">
            üö™ Logout
          </a>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="dashboard-main">

    <div style="background: white; padding: 40px; border-radius: 16px; box-shadow: 0 5px 25px rgba(0,0,0,0.05);">

      <!-- Header -->
      <div
        style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px;">
        <div>
          <h2 style="margin: 0; color: var(--primary-color); font-family: var(--font-serif);">Issue #{{ issue.id }}</h2>
          <span style="color: #666; font-size: 14px;">Reported on {{ issue.created_at[:10] }}</span>
        </div>

        <span class="status-badge" style="padding: 8px 16px; border-radius: 30px; font-weight: 600; font-size: 14px;
          {% if issue.status == 'Completed' %} background: #def7ec; color: #047857;
          {% elif issue.status == 'In Progress' %} background: #e1effe; color: #1e429f;
          {% else %} background: #fff8dd; color: #92400e; {% endif %}">
          {{ issue.status }}
        </span>
      </div>

      <!-- Details Grid -->
      <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 40px;">

        <!-- Left: Description -->
        <div>
          <h5 style="margin-top: 0; color: #444; font-size: 12px; letter-spacing: 1px; text-transform: uppercase;">
            Category</h5>
          <p style="font-size: 18px; font-weight: 600; color: #222; margin-top: 5px;">{{ issue.category }}</p>

          <h5 style="margin-top: 30px; color: #444; font-size: 12px; letter-spacing: 1px; text-transform: uppercase;">
            Description</h5>
          <div
            style="background: #f8fafc; padding: 20px; border-radius: 8px; border: 1px solid #eef2f6; line-height: 1.7; color: #333;">
            {{ issue.description }}
          </div>

          <h5 style="margin-top: 30px; color: #444; font-size: 12px; letter-spacing: 1px; text-transform: uppercase;">
            Location</h5>
          <p style="font-size: 16px; color: #222; margin-top: 5px;">üìç {{ issue.location }}</p>
        </div>

        <!-- Right: Actions & Photo -->
        <div>
          <div style="background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 25px;">
            <h4 style="margin-top: 0; margin-bottom: 20px; color: var(--primary-color);">Update Status</h4>

            <form method="post" action="{{ url_for('update_issue', issue_id=issue.id) }}">
              <div class="form-group">
                <label style="font-size: 12px; font-weight: 600; color: #666;">Current Status</label>
                <select name="status"
                  style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-top: 5px;">
                  <option {% if issue.status=='Pending' %}selected{% endif %}>Pending</option>
                  <option {% if issue.status=='In Progress' %}selected{% endif %}>In Progress</option>
                  <option {% if issue.status=='Completed' %}selected{% endif %}>Completed</option>
                  <option {% if issue.status=='Rejected' %}selected{% endif %}>Rejected</option>
                </select>
              </div>

              <button type="submit" class="primary-btn"
                style="width: 100%; margin-top: 15px; justify-content: center;">Update Status</button>
            </form>
          </div>

          {% if issue.photo_path %}
          <div style="margin-top: 30px;">
            <h5
              style="margin-top: 0; color: #444; font-size: 12px; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 10px;">
              Attachment</h5>
            <img src="{{ url_for('static', filename='uploads/' + issue.photo_path.split('/')[-1]) }}"
              style="width: 100%; border-radius: 8px; border: 1px solid #eee;">
          </div>
          {% endif %}
        </div>

      </div>

    </div>

  </main>

</div>

{% endblock %}