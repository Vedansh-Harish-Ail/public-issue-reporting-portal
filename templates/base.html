<!doctype html>
<html lang="{{ session.get('lang', 'en') }}">

<head>
    <meta charset="utf-8">
    <title>Public Issue Reporting Portal | Meri Panchayat Shammi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='image/logo_left.png') }}">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap"
        rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
    {% block css %}{% endblock %}
</head>

<body class="lang-{{ session.get('lang', 'en') }}">
    <!--
         TOP GOVERNMENT STRIP 

    <div class="gov-strip">
        <div class="container">
            <span>भारत सरकार | Government of India</span>
            <span style="float: right; font-size: 12px;">Ministry of Panchayati Raj</span>
        </div>
    </div>
    -->

    <!-- LOGO BAR -->
    <div class="logo-bar">
        <div class="container logo-container">
            <div class="logo-left">
                <img src="{{ url_for('static', filename='image/logo_left.png') }}" alt="Meri Panchayat Logo">
                <div class="logo-text">
                    <strong>मेरी पंचायत</strong><br>
                    <small>Meri Panchayat<br>Empowering Rural India</small>
                </div>
            </div>
            <div class="logo-right">
                <img src="{{ url_for('static', filename='image/logo_right1.png') }}" alt="Digital India">
                <img src="{{ url_for('static', filename='image/logo_right2.png') }}" alt="Azadi Ka Amrit Mahotsav">
            </div>
        </div>
    </div>
    <!-- NAVIGATION BAR -->
    <nav class="main-nav">
        <div class="container nav-container">
            <!-- Hamburger Button -->
            <button class="burger-btn" id="burgerBtn" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>

            <!-- Navigation Content (Links + Actions) -->
            <div class="nav-content-wrapper" id="navContent">
                <div class="mobile-menu-header">
                    <span class="mobile-menu-title">{{ get_text('menu') }}</span>
                    <button class="close-menu-btn" id="closeBtn">&times;</button>
                </div>

                <ul class="nav-links">
                    {% if session.get('admin_id') %}

                    <li>
                        <a href="{{ url_for('admin_dashboard') }}#recent-complaints">{{ get_text('manage_issues') }}</a>
                    </li>
                    <li>
                        <a href="{{ url_for('admin_notices') }}">{{ get_text('manage_notices') }}</a>
                    </li>
                    {% else %}
                    <li>
                        <a href="{{ url_for('home') }}">{{ get_text('home') }}</a>
                    </li>
                    <li>
                        <!-- Scrolls to About section on home page -->
                        <a href="{{ url_for('home') }}#about-scheme">{{ get_text('about_scheme') }}</a>
                    </li>
                    <li>
                        <a href="{{ url_for('report_issue') }}">{{ get_text('report_issue') }}</a>
                    </li>
                    {% if session.get('user_id') %}
                    <li>
                        <a href="{{ url_for('track_issue') }}">{{ get_text('my_issues') }}</a>
                    </li>
                    {% endif %}
                    <li>
                        <a href="{{ url_for('public_track') }}">{{ get_text('public_issues') }}</a>
                    </li>
                    <li>
                        <a href="{{ url_for('notices') }}">{{ get_text('public_notices') }}</a>
                    </li>
                    {% endif %}
                </ul>

                <div class="nav-actions">

                    {% if session.get('admin_id') %}
                    <a href="{{ url_for('admin_dashboard') }}" class="login-btn">{{ get_text('dashboard') }}</a>
                    <a href="{{ url_for('admin_logout') }}" class="login-btn" style="background: #dc3545;">{{
                        get_text('logout') }}</a>
                    {% elif session.get('user_id') %}
                    <div class="user-profile-group">
                        <a href="{{ url_for('user_profile') }}" class="user-greet-link">
                            {{ get_text('hi') }}, {{ session.get('user_name') }}
                        </a>
                        <a href="{{ url_for('user_logout') }}" class="login-btn logout-btn">{{
                            get_text('logout') }}</a>
                    </div>
                    {% else %}
                    <a href="{{ url_for('admin_login') }}" class="login-btn official-btn">{{
                        get_text('Panchayat login') }}</a>
                    <a href="{{ url_for('user_login') }}" class="login-btn">{{ get_text('login') }}</a>
                    <a href="{{ url_for('user_register') }}" class="login-btn register-outline-btn">{{
                        get_text('register') }}</a>
                    {% endif %}
                </div>
            </div>

            <!-- Overlay -->
            <div class="nav-overlay" id="navOverlay"></div>
        </div>
    </nav>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const burgerBtn = document.getElementById('burgerBtn');
            const closeBtn = document.getElementById('closeBtn');
            const navContent = document.getElementById('navContent');
            const navOverlay = document.getElementById('navOverlay');

            function toggleMenu() {
                navContent.classList.toggle('active');
                navOverlay.classList.toggle('active');
                document.body.classList.toggle('no-scroll');

                // Hide language selector when menu is open to prevent overlap
                const langWidget = document.querySelector('.language-selector-widget');
                if (langWidget) {
                    if (navContent.classList.contains('active')) {
                        langWidget.style.display = 'none';
                    } else {
                        langWidget.style.display = 'block';
                    }
                }
            }

            if (burgerBtn) burgerBtn.addEventListener('click', toggleMenu);
            if (closeBtn) closeBtn.addEventListener('click', toggleMenu);
            if (navOverlay) navOverlay.addEventListener('click', toggleMenu);

            // Close menu when clicking a link
            const navLinks = document.querySelectorAll('.nav-links a');
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (navContent.classList.contains('active')) {
                        toggleMenu();
                    }
                });
            });
        });
    </script>
    </nav>
    <!-- PAGE CONTENT -->
    <main class="{% block main_class %}{% endblock %}">
        <div class="container">
            <!-- Flash Messages -->

        </div>

        {% block content %}{% endblock %}
    </main>

    <!-- GOVERNMENT FOOTER -->
    <footer class="gov-footer">
        <div class="container footer-container">

            <div class="footer-col">
                <h5>{{ get_text('information') }}</h5>
                <ul>
                    <li><a href="{{ url_for('about') }}">{{ get_text('about_us') }}</a></li>
                    <li><a href="#">{{ get_text('terms_use') }}</a></li>
                    <li><a href="#">{{ get_text('privacy_policy') }}</a></li>
                    <li><a href="#">{{ get_text('contact_us') }}</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h5>{{ get_text('important_links') }}</h5>
                <ul>
                    <li><a href="https://panchayat.gov.in" target="_blank">{{ get_text('ministry_name') }}</a></li>
                    <li><a href="https://egramswaraj.gov.in" target="_blank">eGramSwaraj</a></li>
                    <li><a href="https://serviceonline.gov.in" target="_blank">ServicePlus</a></li>
                </ul>
            </div>

            <div class="footer-col footer-contact">
                <h5>{{ get_text('contact') }}</h5>
                <p>
                    <strong>{{ get_text('ministry_name') }}</strong><br>
                    {{ get_text('govt_india') }}<br>
                    {{ get_text('address_line') }}
                </p>
                <div style="margin-top: 15px;">
                    <a href="{{ url_for('admin_login') }}"
                        style="color: var(--secondary-color); font-size: 14px; text-decoration: none; font-weight: 600;">➔
                        {{ get_text('official_admin_login') }}</a>
                </div>
            </div>

        </div>
        <div class="sub-footer">
            <div class="container text-center">
                <p>{{ get_text('designed_by')|safe }}</p>
            </div>
        </div>
    </footer>

    <!-- Floating Language Selector -->
    <div class="language-selector-widget">
        <button class="lang-toggle-btn" id="langToggleBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path
                    d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z" />
            </svg>
            <span id="currentLangText">
                {% if session.get('lang') == 'kn' %}ಕನ್ನಡ{% else %}English{% endif %}
            </span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        </button>
        <div class="lang-dropdown" id="langDropdown">
            <a href="{{ url_for('set_language', lang_code='en') }}"
                class="lang-option {% if session.get('lang', 'en') == 'en' %}active{% endif %}">
                English
            </a>
            <a href="{{ url_for('set_language', lang_code='kn') }}"
                class="lang-option {% if session.get('lang') == 'kn' %}active{% endif %}">
                ಕನ್ನಡ (Kannada)
            </a>
        </div>
    </div>

    <script>
        // Language selector toggle
        const langToggleBtn = document.getElementById('langToggleBtn');
        const langDropdown = document.getElementById('langDropdown');

        langToggleBtn.addEventListener('click', function (e) {
            e.stopPropagation();
            langDropdown.classList.toggle('show');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function () {
            langDropdown.classList.remove('show');
        });

        // Prevent dropdown from closing when clicking inside it
        langDropdown.addEventListener('click', function (e) {
            e.stopPropagation();
        });
    </script>

    <script>
        // Banner Slider Script
        document.addEventListener("DOMContentLoaded", function () {
            const slides = document.querySelectorAll(".banner-img");
            if (slides.length > 1) {
                let currentIndex = 0;
                setInterval(() => {
                    slides[currentIndex].classList.remove("active");
                    currentIndex = (currentIndex + 1) % slides.length;
                    slides[currentIndex].classList.add("active");
                }, 1000);
            }
        });

    </script>
    <!-- Popup Overlay Container -->
    <div id="popup-overlay" class="popup-overlay"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Get messages from Flask
            const messages = {{ get_flashed_messages(with_categories = true) | tojson | safe
        }};

        if (messages && messages.length > 0) {
            // Show first message immediately for now
            messages.forEach(([category, message]) => {
                createPopup(message, category);
            });
        }
        });

        function createPopup(message, type = 'info') {
            const container = document.getElementById('popup-overlay');

            // Map flask categories to design
            let title = 'Info';
            let iconPath = '';
            let colorClass = '';

            if (type === 'success') {
                title = 'Success';
                colorClass = 'popup-success';
                // Checkmark
                iconPath = '<path d="M20 6L9 17l-5-5" stroke-linecap="round" stroke-linejoin="round"></path>';
            } else if (type === 'danger' || type === 'error') {
                title = 'Error';
                colorClass = 'popup-error';
                // X Icon
                iconPath = '<path d="M18 6L6 18M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>';
            } else if (type === 'warning') {
                title = 'Warning';
                colorClass = 'popup-warning';
                // Exclamation
                iconPath = '<path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" stroke-linecap="round" stroke-linejoin="round"></path>';
            } else {
                title = 'Notice';
                colorClass = 'popup-info';
                // Info
                iconPath = '<path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round" stroke-linejoin="round"></path>';
            }

            const popup = document.createElement('div');
            popup.className = 'popup-card';

            popup.innerHTML = `
                <div class="popup-icon-wrapper ${colorClass}">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        ${iconPath}
                    </svg>
                </div>
                <h3 class="popup-title">${title}</h3>
                <p class="popup-message">${message}</p>
                <button class="popup-btn ${colorClass}" onclick="closePopup(this)">OK</button>
            `;

            container.appendChild(popup);
            container.classList.add('active'); // Show overlay
        }

        function closePopup(btn) {
            const popup = btn.closest('.popup-card');
            popup.classList.add('closing');

            // Remove after animation
            setTimeout(() => {
                popup.remove();

                // If no more popups, hide overlay
                const container = document.getElementById('popup-overlay');
                if (container.children.length === 0) {
                    container.classList.remove('active');
                }
            }, 300);
        }
    </script>

    <!-- Image Modal -->
    <div id="imageModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10001; cursor: pointer; align-items: center; justify-content: center;">
        <img id="modalImage" src="" style="max-width: 90%; max-height: 90%; object-fit: contain; border-radius: 8px;">
    </div>

    <script>
        function openImageModal(imageSrc) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modalImg.src = imageSrc;
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Close modal on click or ESC key
        document.addEventListener('DOMContentLoaded', function () {
            const modal = document.getElementById('imageModal');
            if (modal) {
                modal.addEventListener('click', closeImageModal);
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape') closeImageModal();
                });
            }
        });
    </script>
</body>

</html>